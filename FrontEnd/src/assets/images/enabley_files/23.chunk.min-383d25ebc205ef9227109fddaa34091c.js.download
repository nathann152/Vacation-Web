(window.webpackJsonpecho=window.webpackJsonpecho||[]).push([[23],{2160:function(e,t,a){"use strict";var n=a(5),s=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(a(23)),o=s(a(40)),l=s(a(9)),r=s(a(43)),c=s(a(3)),d=s(a(4)),u=s(a(12)),p=s(a(6)),f=s(a(8)),h=s(a(7)),m=s(a(156)),_=s(a(106)),v=n(a(0)),g=(s(a(2)),s(a(24))),E=s(a(11)),I=s(a(261)),C=a(259),b=a(177),N=s(a(18)),S=s(a(13)),x=s(a(154)),O=s(a(21)),T=s(a(603)),y=s(a(1243)),k=s(a(53)),M=s(a(28)),P=s(a(60)),L=s(a(36)),A=s(a(58)),w=s(a(41)),F=s(a(2278)),R=s(a(2654)),D=s(a(2655)),U=s(a(57)),G=a(503),B=a(510),H=s(a(2656));function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,h.default)(e);if(t){var s=(0,h.default)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,f.default)(this,a)}}var X=k.default.LogManager,W=M.default.Instance,j=function(e){(0,p.default)(a,e);var t=Y(a);function a(e){var n;return(0,c.default)(this,a),(n=t.call(this,e))._keyDown=function(e){"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),n.props.onClose())},n._itemRefs={},n._itemMap=new Map,n._isMobile=S.default.isMobile(),n._instructorsMap={},n.inboxRef=(0,v.createRef)(),n._getItems=n._getItems.bind((0,u.default)(n)),n._onFolderChange=n._onFolderChange.bind((0,u.default)(n)),n._getNewInstructorMessages=n._getNewInstructorMessages.bind((0,u.default)(n)),n._onFilterChange=n._onFilterChange.bind((0,u.default)(n)),n.expandInboxHandler=n.props.inboxType===G.INBOX_TYPE.MESSAGING?n.props.expandInbox:n._getConvDetails.bind((0,u.default)(n)),n.state={isInboxExpanded:!(!e.toolParams||"true"!==e.toolParams.isInboxExpanded),selectedId:e.toolParams&&e.toolParams.selectedId?e.toolParams.selectedId:null,placeholderConvDetails:null,itemsIds:[],selectedFolder:e.toolParams&&e.toolParams.selectedFolder?e.toolParams.selectedFolder:"inbox",channels:[],selectedFilterId:n.props.channelId||0,isLoaderOn:!0,composeProps:null,showUserSelectionDialog:!1,usersForSelectionDialog:null,resolveUserSelection:null,rejectUserSelection:null,showLearnerSelectionDialog:!1,showConversation:!(!e.toolParams||"true"!==e.toolParams.showConversation),numOfItems:40,limit:20},n.selectUserFromDialog=n.selectUserFromDialog.bind((0,u.default)(n)),n.cancelUserSelection=n.cancelUserSelection.bind((0,u.default)(n)),n.showLearnerSelectionDialog=n.showLearnerSelectionDialog.bind((0,u.default)(n)),n.closeLearnerSelectionDialog=n.closeLearnerSelectionDialog.bind((0,u.default)(n)),n.initiateChatWithLearner=n.initiateChatWithLearner.bind((0,u.default)(n)),n._setToolbar=n._setToolbar.bind((0,u.default)(n)),n._collapseInbox=n._collapseInbox.bind((0,u.default)(n)),n._expandInbox=n._expandInbox.bind((0,u.default)(n)),n.onScroll=n.onScroll.bind((0,u.default)(n)),n}return(0,d.default)(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.inboxType===G.INBOX_TYPE.MESSAGING&&(e.selectedItemId!==this.props.selectedItemId&&(e.isConversationExpanded?this._getConvDetails(e.selectedItemId):S.default.isMobile()&&this._collapseInbox()),e.updatedConversation&&this.onConversationUpdated(e.updatedConversation))}},{key:"UNSAFE_componentWillUpdate",value:function(e){e.updatedConversation&&this.props.resetUpdatedConversation()}},{key:"componentDidMount",value:function(){var e=this,t=function(){Promise.all([e._getItems()].concat(e.props.includeFilters?e._getChannels():[])).then((function(t){var a=(0,r.default)(t,2),n=a[0],s=a[1];if(e._isMobile){var i=e.state,o=i.showConversation,l=i.selectedId;e._setToolbar(!0,o,l,o)}e.setState({itemsIds:n,channels:s,isLoaderOn:!1})})).catch((function(t){t&&"offline"===t.message&&e.props.onClose()}))};this.props.getList&&(this.props.inboxType===G.INBOX_TYPE.MESSAGING&&S.default.isLearner()?this._getInstructorsMap().then((function(a){e._instructorsMap=a||{},t()})):t()),(this._isMobile||this.state.isInboxExpanded)&&this._setToolbar(!0),this._isMobile&&(this._scrollbaleElement=document.querySelector(".scrollable"),this._scrollbaleElement&&this._scrollbaleElement.addEventListener("scroll",this.onScroll,!1)),window.addEventListener("keydown",this._keyDown),y.default.hideLauncher()}},{key:"componentDidUpdate",value:function(e,t){var a=this;if((!this.state.showConversation&&this.state.showConversation!==t.showConversation||this.state.itemsIds.length&&this.state.itemsIds.length!==t.itemsIds.length)&&(this._scrollbaleElement&&(this._scrollbaleElement=document.querySelector(".scrollable"),this._scrollbaleElement.removeEventListener("scroll",this.onScroll,!1),this._scrollbaleElement.addEventListener("scroll",this.onScroll,!1)),this._scrollToSelectedItem()),this.state.selectedFilterId===t.selectedFilterId&&this.state.selectedFolder===t.selectedFolder||("function"==typeof this.props.onSelectedFilterChanged&&this.props.onSelectedFilterChanged(this.state.selectedFilterId),this._getItems().then((function(e){var t=null;!a._isMobile&&a.state.isInboxExpanded&&e.length&&(t=e[0],a._setItemRead(t)),a.setState({itemsIds:e,selectedId:t,isLoaderOn:!1})}))),this.state.isInboxExpanded!==t.isInboxExpanded||this.state.selectedId!==t.selectedId||this.state.selectedFilterId!==t.selectedFilterId||this.state.selectedFolder!==t.selectedFolder||this.state.showConversation!==t.showConversation){var n="/isInboxExpanded/".concat(this.state.isInboxExpanded);this.state.selectedFolder&&(n+="/selectedFolder/".concat(this.state.selectedFolder)),this.state.selectedId&&(n+="/selectedId/".concat(this.state.selectedId)),this.state.selectedFilterId&&(n+="/channelId/".concat(this.state.selectedFilterId)),this.state.showConversation&&(n+="/showConversation/".concat(this.state.showConversation)),x.default.addToolParams(n)}}},{key:"componentWillUnmount",value:function(){y.default.showLauncher(),this._scrollbaleElement&&this._scrollbaleElement.removeEventListener("scroll",this.onScroll,!1),(this.state.isInboxExpanded||this._isMobile)&&this._setToolbar(!1),window.removeEventListener("keydown",this._keyDown)}},{key:"onScroll",value:function(){var e=this.state,t=e.itemsIds,a=e.numOfItems,n=e.limit;if(t&&t.length&&this._scrollbaleElement.scrollTop+this._scrollbaleElement.clientHeight>=this._scrollbaleElement.scrollHeight-this._scrollbaleElement.offsetTop-100){var s=a+n;s<=t.length&&this.setState({numOfItems:s})}}},{key:"_renderMobileTemplate",value:function(){var e,t,a=this,n=null,s=N.default.translate("inbox.button.send-message"),i=this._getList(),o=this.state.isLoaderOn?void 0:function(){a.props.inboxType===G.INBOX_TYPE.MESSAGING&&w.default.sendEvent(w.default.TITLES.SELECT_RECIPIENT_FROM_LIST,w.default.COMPONENTS.MESSAGE_PANE,(0,l.default)({},w.default.PARAMS.USER_ACTION,"view_all")),a.expandInboxHandler(a.state.itemsIds.length?a.state.itemsIds[0]:null)},r=this._getCompose(),c=this._getAttachPicker(),d=this._getListHeader(),u="done"===this.state.selectedFolder?"inbox.button.mark-inbox":"inbox.button.mark-done";if(this.state.showConversation){var p=this._itemMap.get(this.state.selectedId);if(this.state.selectedId&&p){var f=this.state.placeholderConvDetails||p;n=this.props.getPreviewComponent(f,!!this.state.placeholderConvDetails,this._getChannelContext());var h=this.props.getAvailableButtons(p);if(h&&this.props.toggleCompose){var m=h.find((function(e){return"sendMessage"===e.id}));m&&(t=this._sendMessage.bind(this,p),s=m.label||s)}}else n=v.default.createElement("div",null)}else n=null;this.state.selectedId&&(e=this._moveFolder.bind(this,this.state.selectedId));var _=(0,E.default)("t2k-app__inbox-wrapper",{"t2k-app__inbox-wrapper--compose":!!r}),g=(0,E.default)("inbox__expand",{"inbox__expand--hidden":this.state.isInboxExpanded,"inbox__expand--conversation":this.props.inboxType===G.INBOX_TYPE.MESSAGING}),I=(0,E.default)("inbox__preview",{"inbox__preview--opened":this.state.isInboxExpanded}),C=(0,E.default)("inbox__mask",{"inbox__mask--hidden":this.state.isInboxExpanded}),b=(0,E.default)("inbox__list",{"inbox__list--opened":this.state.isInboxExpanded}),x=this._getLoader();return v.default.createElement("div",{className:_},v.default.createElement("div",{className:"inbox"},v.default.createElement("div",{className:C,onClick:this.props.onClose,onTouchStart:this.props.onClose}),n?null:v.default.createElement("div",{className:b},d,v.default.createElement("div",{className:"inbox__items scrollable",ref:function(e){a._itemsList=e}},i,x),S.default.isMobile()?null:v.default.createElement("div",{className:g,onClick:o},v.default.createElement("span",{className:"inbox__expand-text"},N.default.translate("message.view.all")))),v.default.createElement("div",{className:I},v.default.createElement("div",{className:"inbox__preview-content"},n),this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS?v.default.createElement("div",{className:"inbox__preview-footer"},v.default.createElement("div",{className:"inbox__buttons"},v.default.createElement(L.default,{styleClass:"inbox__button",onClick:e,text:N.default.translate(u),disabled:!e,type:L.default.TYPES.SECONDARY}),t&&v.default.createElement(L.default,{styleClass:"inbox__button",onClick:t,text:s}))):null),r," ",c),this._renderUserSelectionDialog(),this._renderLearnerSelectionDialog())}},{key:"render",value:function(){var e,t,a,n=this;if(this._isMobile)return this._renderMobileTemplate();if(this.props.isClosed)return this._renderPartialInbox();var s=N.default.translate("inbox.button.send-message"),i=this._getList(),o=this.state.isLoaderOn||this._isMobile?void 0:function(){n.props.inboxType===G.INBOX_TYPE.MESSAGING?w.default.sendEvent(w.default.TITLES.SELECT_RECIPIENT_FROM_LIST,w.default.COMPONENTS.MESSAGE_PANE,(0,l.default)({},w.default.PARAMS.USER_ACTION,"view_all")):w.default.sendEvent(w.default.TITLES.SELECT_NOTIFICATION,w.default.COMPONENTS.NOTIFICATIONS_PANE,(0,l.default)({},w.default.PARAMS.USER_ACTION,"view_all")),n.expandInboxHandler(n.state.itemsIds.length?n.state.itemsIds[0]:null)},r=this._getCompose(),c=this._getAttachPicker(),d=this._getListHeader(),u="done"===this.state.selectedFolder?"inbox.button.mark-inbox":"inbox.button.mark-done";if(this.state.isInboxExpanded){var p=this._itemMap.get(this.state.selectedId);if(this.state.selectedId&&p){var f=this.state.placeholderConvDetails||p;e=this.props.getPreviewComponent(f,!!this.state.placeholderConvDetails,this._getChannelContext(),this.props.onClose);var h=this.props.getAvailableButtons(p);if(h&&this.props.toggleCompose){var m=h.find((function(e){return"sendMessage"===e.id}));m&&(a=this._sendMessage.bind(this,p),s=m.label||s)}}else e=v.default.createElement("div",null)}else e=null;this.state.selectedId&&(t=this._moveFolder.bind(this,this.state.selectedId));var _=(0,E.default)("t2k-app__inbox-wrapper",{"t2k-app__inbox-wrapper--compose":!!r}),g=(0,E.default)("inbox__expand",{"inbox__expand--hidden":this.state.isInboxExpanded,"inbox__expand--conversation":this.props.inboxType===G.INBOX_TYPE.MESSAGING}),I=(0,E.default)("inbox__preview",{"inbox__preview--opened":this.state.isInboxExpanded}),C=(0,E.default)("inbox__mask",{"inbox__mask--hidden":this.state.isInboxExpanded}),b=(0,E.default)("inbox__list",{"inbox__list--opened":this.state.isInboxExpanded}),S=this._getLoader();return v.default.createElement("div",{className:_,ref:this.inboxRef},v.default.createElement("div",{className:"inbox"},v.default.createElement("div",{className:C,onClick:this.props.onClose,onTouchStart:this.props.onClose}),this.state.isInboxExpanded&&this._isMobile?null:v.default.createElement("div",{className:b},d,v.default.createElement("div",{className:"inbox__items scrollable",ref:function(e){n._itemsList=e}},i,S),this._isMobile?null:v.default.createElement("div",{className:g,onClick:o},v.default.createElement("span",{className:"inbox__expand-text"},N.default.translate("message.view.all")))),v.default.createElement("div",{className:I},v.default.createElement("div",{className:"inbox__preview-content"},e),this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS?v.default.createElement("div",{className:"inbox__preview-footer"},v.default.createElement("div",{className:"inbox__buttons"},v.default.createElement(L.default,{styleClass:"inbox__button",onClick:t,text:N.default.translate(u),disabled:!t,type:L.default.TYPES.SECONDARY}),a&&v.default.createElement(L.default,{styleClass:"inbox__button",onClick:a,text:s}))):null),r," ",c),this._renderUserSelectionDialog(),this._renderLearnerSelectionDialog())}},{key:"_renderPartialInbox",value:function(){var e=this._getCompose(),t=this._getAttachPicker();return e||t?v.default.createElement("div",{className:"inbox inbox-partial"},e," ",t):null}},{key:"selectUserFromDialog",value:function(e){var t=this;return new Promise((function(a,n){t.setState({showUserSelectionDialog:!0,usersForSelectionDialog:e,resolveUserSelection:a,rejectUserSelection:n})}))}},{key:"cancelUserSelection",value:function(){this.state.rejectUserSelection(),this.setState({showUserSelectionDialog:!1})}},{key:"_renderUserSelectionDialog",value:function(){var e=this;if(!this.state.showUserSelectionDialog)return null;var t={title:N.default.translate("messaging.dialog.select-recipient"),styleClass:"user-selection-dialog",close:this.cancelUserSelection};function a(e){this.state.resolveUserSelection(e),this.setState({showUserSelectionDialog:!1})}return v.default.createElement(A.default,t,v.default.createElement("div",{className:"user-selection-dialog__user-list"},this.state.usersForSelectionDialog.map((function(t){var n=a.bind(e,t);return v.default.createElement("div",{className:"user-selection-dialog__user",key:t.userId,onClick:n},t.displayName)}))))}},{key:"_getConfig",value:function(){var e={},t=!this.state.isInboxExpanded&&!S.default.isMobile();switch(this.props.inboxType){case G.INBOX_TYPE.NOTIFICATIONS:t&&(e.quantity=20),this.state.selectedFilterId&&(e.scopes="CHANNEL:".concat(this.state.selectedFilterId)),"done"===this.state.selectedFolder&&(e.isDone=!0);break;case G.INBOX_TYPE.MESSAGING:e.pageIndex=0,e.pageSize=t?20:200,this.state.selectedFilterId&&(e.channelId=this.state.selectedFilterId)}return{params:e}}},{key:"_getItems",value:function(){var e=this,t=this.props.getList,a=t.url,n=t.params,s=t.config,i=this._getConfig(),o=(0,_.default)({},s,i);return W.get(a,n,o).then((function(t){var a=[];switch(e.props.inboxType){case G.INBOX_TYPE.NOTIFICATIONS:a=t;break;case G.INBOX_TYPE.MESSAGING:a=t.elements.filter((function(e){return!!e.lastMessage})),S.default.isLearner()&&(a=a.concat(e._getNewInstructorMessages(a,e.state.selectedFilterId)))}e._itemRefs={},e._itemMap=new Map,a.forEach((function(t){e._itemMap.set(t.id,t)}),e);var n=a.map((function(e){return e.id}));return Promise.resolve(n)})).catch((function(e){return X.error("echo",{message:"Inbox: error in getting list. ".concat(JSON.stringify(e))}),Promise.reject(e)}))}},{key:"_getInstructorsMap",value:function(){return W.get(U.default.GET_INSTRUCTORS,{},{failOnOffline:!0}).then((function(e){return Promise.resolve(e)})).catch((function(e){X.error("echo",{message:"Inbox: error in getting instructors list. ".concat(JSON.stringify(e))})}))}},{key:"_getNewInstructorMessages",value:function(e,t){var a=[],n=t?this._instructorsMap.channelToInstructorsMap[t]:this._instructorsMap.allInstructors;if(n&&n.length){if(e.length){var s=new Set;e.forEach((function(e){return e.participants.forEach((function(e){return s.add(e.userId)}))})),n=n.filter((function(e){return!s.has(e.userId)}))}var i={instructor:N.default.translate("messaging.instructor"),startConversation:N.default.translate("messaging.start-conversation")};a=n.map((function(e){return{id:"placeholder-"+e.userId,title:"".concat(e.displayName," (").concat(i.instructor,")"),lastMessage:{body:i.startConversation},participants:{id:e.userId,displayName:e.displayName},read:!0}}))}return a}},{key:"_getChannels",value:function(){var e=this;return W.get(U.default.GET_CHANNEL_LIST).then((function(t){var a=[];if(t&&t.length&&(a=(a=(0,m.default)(t,(function(e){return e.name}))).map((function(e){return{id:e.id,label:e.name}}))),a.unshift({id:0,label:N.default.translate("inbox.filter.all-groups")}),e.state.selectedFilterId){var n=a.find((function(t){return t.id===e.props.channelId}));n?n.selected=!0:a[0].selected=!0}else a[0].selected=!0;return Promise.resolve(a)})).catch((function(e){X.error("echo",{message:"Inbox: error in getting channels. ".concat(JSON.stringify(e))})}))}},{key:"_getConvDetails",value:function(e){var t=this,a=this._itemMap.get(e);e&&-1!==e.indexOf("placeholder-")?W.get(U.default.GET_CONVERSATION,{},{params:{userIds:a.participants.id}}).then((function(a){t._expandInbox(e,a,S.default.isMobile())})).catch((function(e){X.error("echo",{message:"Inbox: error in getting conversation Id. ".concat(JSON.stringify(e))})})):this._expandInbox(e,null,S.default.isMobile())}},{key:"_scrollToSelectedItem",value:function(){if(this.state.isInboxExpanded&&this.state.selectedId){var e=this._itemRefs[this.state.selectedId];if(!e)return;var t=g.default.findDOMNode(e).getBoundingClientRect(),a=t.top,n=t.bottom,s=this._itemsList.getBoundingClientRect(),i=s.top,o=s.bottom;(a<i||n>o)&&(this._itemsList.scrollTop=a-i)}}},{key:"handleClickOutside",value:function(e){this.state.showLearnerSelectionDialog||(this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS&&-1!==e.target.id.indexOf("messaging")||this.props.inboxType===G.INBOX_TYPE.MESSAGING&&-1!==e.target.id.indexOf("notification")||!this.state.isInboxExpanded&&this.props.onClickOutsideIgnoreId&&null===e.target.id.match(this.props.onClickOutsideIgnoreId))&&this.props.onClose()}},{key:"_getLoader",value:function(){return this.state.isLoaderOn?v.default.createElement("div",{className:"inbox__loader"},v.default.createElement(P.default,{size:P.default.Sizes.SMALL})):""}},{key:"_getList",value:function(){var e=this;if(this.state.itemsIds.length){var t=this.state.itemsIds;if(this._isMobile){t=(0,o.default)(t);var a=this.state.numOfItems;t=t.splice(0,a)}return t.map((function(t,a){var n=e._itemMap.get(t),s=e.props.getMessageProps(n),o=!!n.read||n.lastMessage&&n.lastMessage.read||s.id===e.state.selectedId,l=-1!==n.id.indexOf("placeholder-");return v.default.createElement(H.default,(0,i.default)({},s,{key:"notification-message-".concat(a),onClick:e.expandInboxHandler,isSelected:s.id===e.state.selectedId,isRead:o,isPlaceholder:l,isNotification:e.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS,ref:function(t){e._itemRefs[s.id]=t}}))}),this)}return this.state.isLoaderOn?"":v.default.createElement("div",{className:"inbox__empty-list"},N.default.translate("message.no-message"))}},{key:"_getListHeader",value:function(){if(this.props.includeFilters){var e=this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS?this._getFolders():null,t=this._getFilter(),a=this._getNewChatWithLearnerButton();return v.default.createElement("div",{className:"inbox__top"},a,e,e&&v.default.createElement("div",{className:"inbox__top-separator"}),t)}return null}},{key:"_getNewChatWithLearnerButton",value:function(){var e=this;if(this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS||this.state.isInboxExpanded&&!this._isMobile)return null;var t=N.default.translate("messaging.instructor-chat.tooltip");return v.default.createElement("div",{className:"inbox__learner-chat-button icon--add-button",title:t,onClick:this.showLearnerSelectionDialog,tabIndex:"0",role:"button","aria-label":t,onKeyDown:function(t){return 13===t.keyCode&&e.showLearnerSelectionDialog()}})}},{key:"showLearnerSelectionDialog",value:function(){w.default.sendEvent(w.default.TITLES.START_NEW_CONVERSATION,w.default.COMPONENTS.MESSAGE_PANE,{}),this.setState({showLearnerSelectionDialog:!0})}},{key:"closeLearnerSelectionDialog",value:function(){this.setState({showLearnerSelectionDialog:!1})}},{key:"initiateChatWithLearner",value:function(e){var t=this;w.default.sendEvent(w.default.TITLES.SELECT_RECIPIENT,w.default.COMPONENTS.MESSAGE_PANE,{recipient:e.contactId}),this.setState({showLearnerSelectionDialog:!1},(function(){var a={isSingleMode:!0,recipients:[{id:e.contactId,nickname:e.displayName}]};t.props.toggleCompose(a)}))}},{key:"_renderLearnerSelectionDialog",value:function(){var e=this;if(!this.state.showLearnerSelectionDialog)return null;var t={getItems:function(t){var a={};return Object.assign(a,t?{usernameSubString:t}:{},S.default.isMobile()?{limit:5}:{limit:50},e.state.selectedFilterId?{channelId:e.state.selectedFilterId}:{}),W.get(U.default.GET_LEARNERS_TO_MESSAGE,{},{params:a})},idField:"contactId",labelField:"displayName",onItemSelection:this.initiateChatWithLearner,searchPlaceholder:N.default.translate("messaging.instructor-chat.placeholder"),emptyMessage:N.default.translate("messaging.instructor-chat.empty-message"),emptyWithSearchMessage:N.default.translate("messaging.instructor-chat.empty-message-with-search"),focusInputOnMount:!0,keepOpen:!0,ariaLabel:N.default.translate("messaging.instructor-chat.placeholder")},a={title:N.default.translate("messaging.dialog.select-recipient"),styleClass:(0,E.default)("learner-selection-dialog",{"learner-selection-dialog--mobile":S.default.isMobile()||S.default.isTablet()}),close:this.closeLearnerSelectionDialog};return v.default.createElement(A.default,a,v.default.createElement(F.default,t))}},{key:"_getFolders",value:function(){var e="inbox"===this.state.selectedFolder,t=[{id:"inbox",label:N.default.translate("inbox.title"),selected:e},{id:"done",label:N.default.translate("inbox.done"),selected:!e}];return v.default.createElement(T.default,{className:"inbox__dropdown inbox__dropdown--folders",options:t,onChange:this._onFolderChange,noBorder:!0})}},{key:"_getFilter",value:function(){return v.default.createElement(T.default,{className:"inbox__dropdown inbox__dropdown--filter",options:this.state.channels,onChange:this._onFilterChange,noBorder:!0,getOptionContent:a.getOptionContent,ariaLabel:N.default.translate("inbox.filter.title")})}},{key:"_onFolderChange",value:function(e){w.default.sendEvent(w.default.TITLES.SELECT_NOTIFICATION_TYPE,w.default.COMPONENTS.NOTIFICATIONS_PANE,(0,l.default)({},w.default.PARAMS.TYPE,e.id));var t=e.id;this.setState({selectedFolder:t,itemsIds:[],isLoaderOn:!0})}},{key:"_onFilterChange",value:function(e){this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS?w.default.sendEvent(w.default.TITLES.FILTER_NOTIFICATION_LEARNING_GROUP,w.default.COMPONENTS.NOTIFICATIONS_PANE,{selected_group_name:e.label,selected_group_id:e.id}):w.default.sendEvent(w.default.TITLES.FILTER_LEARNING_GROUP,w.default.COMPONENTS.MESSAGE_PANE,{selected_group_name:e.label,selected_group_id:e.id}),this.setState({selectedFilterId:e.id,isLoaderOn:!0})}},{key:"_collapseInbox",value:function(e){var t=this,a={selectedId:null,isInboxExpanded:!1,showConversation:!1};e&&(a.itemsIds=e),this.setState(a,(function(){t._setToolbar(!0)}))}},{key:"_expandInbox",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s={selectedId:e,placeholderConvDetails:t,isInboxExpanded:!0,isLoaderOn:!1,showConversation:n};this._setItemRead(e),this._setToolbar(!0,S.default.isMobile()&&n,e,n),this.state.isInboxExpanded||S.default.isMobile()?this.setState(s):(s.isLoaderOn=!0,this.setState(s,(function(){a._getItems().then((function(t){!e&&t.length&&(e=t[0],a._setItemRead(e)),a.setState({itemsIds:t,selectedId:e,isLoaderOn:!1})})).catch((function(e){e&&"offline"===e.message&&a.props.onClose()}))})))}},{key:"_setItemRead",value:function(e){if(e){var t=this._itemMap.get(e);if(t&&!t.read)t.read=!0,e&&-1!==e.indexOf("placeholder-")||this._updateItem(e,{},{params:{read:!0}})}}},{key:"_setToolbar",value:function(e,t,a){var n,s=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.props.title,r=this.props.onClose,c=S.default.getAppdata().appConf.featureFlags;if(a=a||this.state.selectedId,this._isMobile&&a&&i){var d=this._itemMap.get(a),u=this.props.getMessageProps(d);o=u.title}n=t?S.default.isMobile()&&this.props.inboxType===G.INBOX_TYPE.NOTIFICATIONS?function(){return s._expandInbox(a,null,!1)}:this.props.collapseInbox:r;var p=e?{id:"inbox",setStore:!0,cordova:{backId:t?"back-inbox":"close-inbox"},primary:[{type:O.default.TOOLBAR_ELEMENT_TYPE.ICON,config:{iconName:t?"arrow-left":"close",id:t?"back-inbox":"close-inbox",isClickable:!0,onButtonClick:n,mixPanel:{params:(0,l.default)({},w.default.PARAMS.TYPE,t?w.default.TOOLBAR_ELEMENTS.BACK:w.default.TOOLBAR_ELEMENTS.CLOSE)}}},{type:O.default.TOOLBAR_ELEMENT_TYPE.TITLE,config:{title:o}}],secondary:[].concat(c.help?[{type:O.default.TOOLBAR_ELEMENT_TYPE.HELP,config:{}}]:[])}:{id:"inbox",fromStore:!0};this.props.appApi.setConfig(void 0,{toolbar:p},(function(){}))}},{key:"_updateItem",value:function(e,t,a){W.put(this.props.updateItem.url,{id:e},t,a).catch((function(t){X.error("echo",{message:"Inbox: failed to update item id ".concat(e,". ").concat(JSON.stringify(t))})}))}},{key:"_moveFolder",value:function(e){var t,a=this;w.default.sendEvent(w.default.TITLES.MOVE_NOTIFICATION_TO_ARCHIVE,w.default.COMPONENTS.NOTIFICATIONS_PANE,(0,l.default)({},w.default.PARAMS.TYPE,"inbox"===this.state.selectedFolder?"archive":"inbox")),t="done"===this.state.selectedFolder?{done:!1}:{done:!0,read:!0},this._updateItem(e,{},{params:t});var n=this.state.selectedId,s=this.state.itemsIds.filter((function(t,s){return t!==e||(e===a.state.selectedId&&(n=s<a.state.itemsIds.length-1?a.state.itemsIds[s+1]:1!==a.state.itemsIds.length?a.state.itemsIds[s-1]:null),!1)}),this);n&&n!==this.state.selectedId&&this._updateItem(n,{},{params:{read:!0}}),S.default.isMobile()?this._collapseInbox(s):this.setState({itemsIds:s,selectedId:n})}},{key:"_sendMessage",value:function(e){var t;w.default.sendEvent(w.default.TITLES.WRITE_MESSAGE_TO_RECIPIENT,w.default.COMPONENTS.NOTIFICATIONS_PANE),this.props.toggleCompose({notification:e,selectUserFromDialog:this.selectUserFromDialog,context:this._getChannelContext(null==e||null===(t=e.header)||void 0===t?void 0:t.channelId)})}},{key:"_getCompose",value:function(){return this.props.composeProps?v.default.createElement(R.default,(0,i.default)({},this.props.composeProps,{attachPickerOpened:!(!this.props.attachPicker||!this.props.attachPicker.opened)})):""}},{key:"_getAttachPicker",value:function(){return this.props.attachPicker&&this.props.attachPicker.opened?v.default.createElement(D.default,{composeOpened:!!this.props.composeProps}):""}},{key:"onConversationUpdated",value:function(e){var t=[];if(this.state.itemsIds.length)if(this.state.itemsIds.indexOf(e.id)>-1)t=this.state.itemsIds[0]===e.id?this.state.itemsIds:this.moveUpLatestConversation(e.id);else if(S.default.isInstructor())t=[e.id].concat(this.state.itemsIds);else{var a=S.default.getUser().id,n="placeholder-"+e.participants.find((function(e){return e.userId!==a})).userId;t=this.state.itemsIds.indexOf(n)>-1?this.moveUpLatestConversation(n,e.id):[e.id].concat(this.state.itemsIds)}else t=[e.id];t.length&&(e.id===this.props.selectedItemId?(e.read=!0,this._updateItem(e.id,{},{params:{read:!0}})):this.props.resetMessageCount(),this._itemMap.set(e.id,e),this.setState({itemsIds:t}))}},{key:"moveUpLatestConversation",value:function(e,t){var a=this.state.itemsIds.filter((function(t){return t!==e}));return[t||e].concat(a)}},{key:"_getChannelContext",value:function(e){var t=e||this.state.selectedFilterId||void 0;return t?{type:"CHANNEL",channelId:t}:void 0}}],[{key:"getOptionContent",value:function(e,t){return t?e.label:v.default.createElement("div",{className:"inbox__dropdown inbox__dropdown--filter--option",title:e.label},e.label)}}]),a}(v.Component);j.defaultProps={onClose:function(){},expandInbox:void 0,toggleCompose:void 0,appApi:{setConfig:function(){}}},j=S.default.isMobile()?j:(0,I.default)(j);var V=(0,C.connect)((function(e,t){return{isClosed:(e=e.messaging).inbox.isClosed&&t.isClosed,composeProps:e.compose,attachPicker:e.attachPicker,updatedConversation:e.updatedConversation,isConversationExpanded:e.inbox&&e.inbox.isConversationExpanded,selectedItemId:e.inbox&&e.inbox.selectedItemId}}),(function(e){return(0,b.bindActionCreators)({toggleCompose:B.toggleCompose,expandInbox:B.expandInbox,collapseInbox:B.collapseInbox,resetUpdatedConversation:B.resetUpdatedConversation,resetMessageCount:B.resetMessageCount},e)}))(j);t.default=V},2278:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(a(2279));a(2280);var i=s.default;t.default=i},2279:function(e,t,a){"use strict";var n=a(5),s=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(a(9)),o=s(a(3)),l=s(a(12)),r=s(a(4)),c=s(a(6)),d=s(a(8)),u=s(a(7)),p=n(a(0)),f=(s(a(2)),s(a(11)));a(73);var h=s(a(237)),m=s(a(22)),_=s(a(60));function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var s=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,d.default)(this,a)}}var g=function(e){(0,c.default)(a,e);var t=v(a);function a(e){var n;return(0,o.default)(this,a),(n=t.call(this,e)).state={showItems:!1,items:[],searchString:"",isLoading:!0},n.handleSearchChange=n.handleSearchChange.bind((0,l.default)(n)),n.handleInputFocus=n.handleInputFocus.bind((0,l.default)(n)),n}return(0,r.default)(a,null,[{key:"_renderLoading",value:function(){return p.default.createElement("ul",{className:"search-dropdown__item-list"},p.default.createElement("li",{className:"search-dropdown__loading"},p.default.createElement(_.default,{size:_.default.Sizes.SMALL,position:_.default.Positions.STATIC})))}}]),(0,r.default)(a,[{key:"componentDidMount",value:function(){this.handleSearchChange("")}},{key:"render",value:function(){var e=(0,f.default)("search-dropdown",(0,i.default)({},this.props.styleClass,!!this.props.styleClass));return p.default.createElement("div",{className:e},this._renderInput(),this._renderItemsArea())}},{key:"_renderInput",value:function(){return p.default.createElement(h.default,{searchPlaceholder:this.props.searchPlaceholder,minSearchLength:this.props.minSearchLength,searchChanged:this.handleSearchChange,onInputFocus:this.handleInputFocus,focusInputOnMount:this.props.focusInputOnMount,ariaLabel:this.props.ariaLabel})}},{key:"_renderItemsArea",value:function(){return this.state.showItems||this.props.keepOpen?this.state.isLoading?a._renderLoading():this.state.items.length>0?this._renderItems():this._renderErrorMessage():null}},{key:"_renderItems",value:function(){var e=this;return p.default.createElement("ul",{className:"search-dropdown__item-list"},this.state.items.map((function(t){return e._renderItem(t)})))}},{key:"_renderItem",value:function(e){var t=this,a=function(){t.props.onItemSelection(e)};return p.default.createElement("li",{className:"search-dropdown__item",onKeyDown:function(e){return 13===e.keyCode&&a()},onMouseDown:a,key:e[this.props.idField]},p.default.createElement("span",{tabIndex:"0",role:"button",className:"search-dropdown__item-name"},e[this.props.labelField]))}},{key:"_renderErrorMessage",value:function(){var e=this.state.searchString?this.props.emptyWithSearchMessage:this.props.emptyMessage;return p.default.createElement("ul",{className:"search-dropdown__item-list"},p.default.createElement("li",{className:"search-dropdown__empty-message"},e))}},{key:"handleSearchChange",value:function(e){var t=this;this.setState({isLoading:!0}),this.props.getItems(e).then((function(a){t.setState({items:a,searchString:e,isLoading:!1})})).catch((function(){t.setState({isLoading:!1})}))}},{key:"handleInputFocus",value:function(e){this.setState({showItems:e})}},{key:"updateItemsByExternalRequest",value:function(){var e=this;this.props.getItems(this.state.searchString).then((function(t){e.setState({items:t})}))}}]),a}(p.Component);g.defaultProps={searchPlaceholder:m.default.translate("search-dropdown.search-placeholder"),emptyMessage:m.default.translate("search-dropdown.empty-message"),emptyWithSearchMessage:m.default.translate("search-dropdown.empty-with-search-message"),minSearchLength:1,focusInputOnMount:!1,keepOpen:!1,styleClass:"",ariaLabel:""};var E=g;t.default=E},2280:function(e,t,a){},2654:function(e,t,a){"use strict";var n=a(5),s=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(a(3)),o=s(a(12)),l=s(a(4)),r=s(a(6)),c=s(a(8)),d=s(a(7)),u=n(a(0)),p=(s(a(2)),s(a(11))),f=s(a(18)),h=s(a(53)),m=s(a(28)),_=s(a(60)),v=a(177),g=a(259);a(73);var E=s(a(57)),I=a(503),C=s(a(1305)),b=a(510);function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,d.default)(e);if(t){var s=(0,d.default)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,c.default)(this,a)}}var S=h.default.LogManager,x=m.default.Instance,O=function(e){(0,r.default)(a,e);var t=N(a);function a(e){var n;(0,i.default)(this,a),(n=t.call(this,e))._keyDown=function(e){"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),n._onClose())},n._onClose=n._onClose.bind((0,o.default)(n)),n._onDiscardCancel=n._onDiscardCancel.bind((0,o.default)(n)),n._recipientNicknames=[],n._recipientIds=[],n.props.compose.recipients.forEach((function(e){e.nickname&&n._recipientNicknames.push(e.nickname||f.default.translate("common.guest")),n._recipientIds.push(e.id)}));var s=I.COMPOSE_STATE.LOADING;return n.props.compose&&n.props.compose.mode===I.COMPOSE_MODE.MULTI&&(s=I.COMPOSE_STATE.COMPOSE),n.state={status:s,className:"",attachPickerOpened:!(!n.props.attachPicker||!n.props.attachPicker.opened)},n}return(0,l.default)(a,null,[{key:"updateItem",value:function(e,t,a){x.put(E.default.UPDATE_CONVERSATION_STATE,{id:e},t,a).catch((function(t){S.error("echo",{message:"Inbox: failed to update item id ".concat(e,". ").concat(JSON.stringify(t))})}))}}]),(0,l.default)(a,[{key:"componentDidMount",value:function(){this.props.compose&&this.props.compose.mode===I.COMPOSE_MODE.SINGLE&&this.props.loadConversation(this._recipientIds.join(",")),window.addEventListener("keydown",this._keyDown,!0)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){!1===e.loadingConversation&&e.conversation&&this.setState({status:I.COMPOSE_STATE.COMPOSE}),e.loadingConversationError&&this.setState({status:I.COMPOSE_STATE.ERROR})}},{key:"UNSAFE_componentWillUpdate",value:function(e){e.updatedConversation&&e.updatedConversation.id===e.conversation.id&&(a.updateItem(e.conversation.id,{},{params:{read:!0}}),this.props.resetUpdatedConversation())}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this._keyDown,!0)}},{key:"render",value:function(){var e=(0,p.default)("compose__content-mask",{"compose__content-mask--show":this.state.status===I.COMPOSE_STATE.DISCARD,"compose__content-mask--show-dark":this.state.attachPickerOpened}),t=(0,p.default)("compose",this.state.className),a=this._getContent(),n=this._getTitle();return u.default.createElement("div",{className:t},u.default.createElement("div",{className:"compose__mask"}),u.default.createElement("div",{className:"compose__window"},n,a,u.default.createElement("div",{className:e})))}},{key:"_getTitle",value:function(){var e=this,t=!1,a=this._onClose,n="";switch(this.state.status){case I.COMPOSE_STATE.DISCARD:return u.default.createElement("div",{className:"compose__title compose__title--discard"},u.default.createElement("div",{className:"compose__title-text"},f.default.translate("inbox.compose.discard-message")),u.default.createElement("div",{className:"compose__title-options"},u.default.createElement("span",{className:"compose__title-option",onClick:function(){e._onClose(!0)}},f.default.translate("global.confirmation.yes")),u.default.createElement("span",{className:"compose__title-option",onClick:this._onDiscardCancel},f.default.translate("global.confirmation.no"))));case I.COMPOSE_STATE.SENDING:a="",t=!0}var s=(0,p.default)("compose__icon","compose__icon--close",{"compose__icon--disabled":t});return n=this.props.compose&&this.props.compose.mode===I.COMPOSE_MODE.MULTI?"".concat(this._recipientIds.length," ").concat(f.default.translate("messaging.recipients")):this._recipientNicknames[0],u.default.createElement("div",{className:"compose__title"},u.default.createElement("div",{className:"compose__title-text"},u.default.createElement("span",{className:"compose__title-label"},f.default.translate("messaging.send-to"),": "),u.default.createElement("span",{className:"compose__title-nicknames"},n)),u.default.createElement("div",{className:s,onClick:a}))}},{key:"_getContent",value:function(){var e=this.props.compose&&this.props.compose.context;return this.state.status===I.COMPOSE_STATE.LOADING?u.default.createElement("div",{className:"compose__content"},u.default.createElement("div",{className:"compose__loader"},u.default.createElement(_.default,{size:_.default.Sizes.SMALL}))):this.state.status===I.COMPOSE_STATE.ERROR?u.default.createElement("div",{className:"compose__content"},u.default.createElement("div",{className:"compose__error"},f.default.translate("messaging.error-load-conversation")," ")):u.default.createElement("div",{className:"compose__content"},u.default.createElement(C.default,{conversation:this.props.conversation,context:e}))}},{key:"_onDiscardCancel",value:function(){this.setState({status:I.COMPOSE_STATE.COMPOSE})}},{key:"_onClose",value:function(){var e=this;this.state.status===I.COMPOSE_STATE.COMPOSE&&(this.props.inputMessage||this._textAreaRef&&this._textAreaRef.value.trim())?this.setState({status:I.COMPOSE_STATE.DISCARD}):this.setState({className:"compose--disappear"},(function(){setTimeout((function(){e.props.toggleCompose()}),500)}))}}]),a}(u.Component);O.defaultProps={compose:null};var T=(0,g.connect)((function(e){return{compose:(e=e.messaging).compose,conversation:e.conversation,loadingConversation:e.loadingConversation,loadingConversationError:e.loadingConversationError,inputMessage:e.inputMessage,attachPicker:e.attachPicker,updatedConversation:e.updatedConversation}}),(function(e){return(0,v.bindActionCreators)({loadConversation:b.loadConversation,toggleCompose:b.toggleCompose,resetUpdatedConversation:b.resetUpdatedConversation},e)}))(O);t.default=T},2655:function(e,t,a){"use strict";var n=a(5),s=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(a(3)),o=s(a(4)),l=s(a(12)),r=s(a(6)),c=s(a(8)),d=s(a(7)),u=n(a(0)),p=(s(a(2)),s(a(11))),f=a(177),h=a(259),m=s(a(18)),_=a(503),v=a(510);function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,d.default)(e);if(t){var s=(0,d.default)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,c.default)(this,a)}}var E=function(e){(0,r.default)(a,e);var t=g(a);function a(e){var n;return(0,i.default)(this,a),(n=t.call(this,e)).state={className:"",composeOpened:!!n.props.compose},n.selectedAttachments=[],n._onClose=n._onClose.bind((0,l.default)(n)),n._addLinksHandler=n._addLinksHandler.bind((0,l.default)(n)),n}return(0,o.default)(a,[{key:"componentDidMount",value:function(){this.props.loadAttachments()}},{key:"render",value:function(){var e=this._getSearchBar(),t=this._getFooter(),a=this._getLinkList(),n=(0,p.default)("attach-picker",this.state.className),s=(0,p.default)("attach-picker__window",{"attach-picker__window--compose-opened":this.state.composeOpened});return u.default.createElement("div",{className:n},this.state.composeOpened?null:u.default.createElement("div",{className:"attach-picker__mask"}),u.default.createElement("div",{className:s},e,u.default.createElement("div",{className:"attach-picker__content"},a),t))}},{key:"_getSearchBar",value:function(){return u.default.createElement("div",{className:"attach-picker__search-bar"},u.default.createElement("input",{className:"attach-picker__input",placeholder:"Cybersecurity",type:"text"}))}},{key:"_getLinkList",value:function(){var e=this;return this.props.attachments?u.default.createElement("div",{className:"attach-picker__link-list scrollable"},this.props.attachments.map((function(t,a){var n={"attach-picker__link-image":!0};return n["attach-picker__link-bg-"+(a+1)]=!0,n=(0,p.default)(n),u.default.createElement("div",{className:"attach-picker__link-item",key:a},u.default.createElement("input",{className:"attach-picker__link-checkbox",type:"checkbox",onChange:function(a){return e._toggleCheckbox(a,t)}}),u.default.createElement("div",{className:n}),u.default.createElement("div",{className:"attach-picker__link-text"},u.default.createElement("div",{className:"attach-picker__link-line1"},t.title),u.default.createElement("div",{className:"attach-picker__link-line2"},"Difficulty: ",t.difficulty)))}))):null}},{key:"_getFooter",value:function(){return u.default.createElement("div",{className:"attach-picker__footer"},u.default.createElement("div",{className:"attach-picker__button",onClick:this._onClose},m.default.translate("messaging.cancel")),u.default.createElement("div",{className:"attach-picker__separator"}),u.default.createElement("div",{className:"attach-picker__button",onClick:this._addLinksHandler},m.default.translate("messaging.add-links")))}},{key:"_toggleCheckbox",value:function(e,t){if(e.target.checked)this.selectedAttachments.push(t);else for(var a=0;a<this.selectedAttachments.length;a++)if(this.selectedAttachments[a].id===t.id){this.selectedAttachments.splice(this.selectedAttachments.indexOf(this.selectedAttachments[a]),1);break}}},{key:"_addLinksHandler",value:function(){var e=this;if(this.selectedAttachments.length){if(this.props.compose&&this.props.compose.mode===_.COMPOSE_MODE.MULTI){var t=this.props.compose.recipients.map((function(e){return e.id}));this.selectedAttachments.forEach((function(a){e.props.sendMessage("link: ".concat(JSON.stringify(a)),t,e.props.compose.context,_.COMPOSE_MODE.MULTI)}))}else this.selectedAttachments.forEach((function(t){e.props.sendMessage("link: ".concat(JSON.stringify(t)),e.props.conversation,e.props.compose?e.props.compose.context:null)}));this._onClose()}}},{key:"_onClose",value:function(){var e=this;this.setState({className:"attach-picker--disappear"},(function(){setTimeout((function(){e.props.closeAttachPicker()}),500)}))}}]),a}(u.Component);E.defaultProps={};var I=(0,h.connect)((function(e){return{attachments:(e=e.messaging).attachments,conversation:e.currentConversation,compose:e.compose}}),(function(e){return(0,f.bindActionCreators)({closeAttachPicker:v.closeAttachPicker,loadAttachments:v.loadAttachments,sendMessage:v.sendMessage},e)}))(E);t.default=I},2656:function(e,t,a){"use strict";var n=a(5),s=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(a(9)),o=s(a(3)),l=s(a(4)),r=s(a(12)),c=s(a(6)),d=s(a(8)),u=s(a(7)),p=n(a(0)),f=(s(a(2)),s(a(11))),h=s(a(13)),m=s(a(2657)),_=s(a(41)),v=s(a(101));function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var s=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,d.default)(this,a)}}var E=function(e){(0,c.default)(a,e);var t=g(a);function a(e){var n;return(0,o.default)(this,a),(n=t.call(this,e)).onClickHandler=n.onClickHandler.bind((0,r.default)(n)),n}return(0,l.default)(a,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.isRead,s=a.isSelected,o=a.icon,l=a.isPlaceholder,r=(e={},(0,i.default)(e,"".concat("message","--unread"),!n),(0,i.default)(e,"".concat("message","--selected"),s),(0,i.default)(e,"".concat("message","--placeholder"),l),e),c=(0,f.default)("message",r),d=o?p.default.createElement("div",{className:"".concat("message","__icon ").concat("message","__icon--").concat(o)}):"",u=new Date(this.props.timestamp),_=this.props.timestamp?u.toLocaleDateString(h.default.getAppdata().appConf.locale.replace("_","-")):"",g=this.props.body.replace(/<\/?[^>]+(>|$)/g," ");return p.default.createElement("div",{tabIndex:"0",role:"button",className:c,onClick:this.onClickHandler,onKeyDown:function(e){return 13===e.keyCode&&t.onClickHandler()}},p.default.createElement("div",{className:"".concat("message","__bar")}),d,p.default.createElement("div",{className:"".concat("message","__wrapper")},p.default.createElement("div",{className:"".concat("message","__details")},p.default.createElement("span",{className:"".concat("message","__title")},this.props.title),p.default.createElement("span",{className:"".concat("message","__time")},_)),p.default.createElement("div",{className:"".concat("message","__body")},p.default.createElement(m.default,{clamp:2},p.default.createElement("div",(0,v.default)(g))))))}},{key:"onClickHandler",value:function(){if(!this.props.isSelected||h.default.isMobile()){var e;if(this.props.isNotification)_.default.sendEvent(_.default.TITLES.SELECT_NOTIFICATION,_.default.COMPONENTS.NOTIFICATIONS_PANE,(e={},(0,i.default)(e,_.default.PARAMS.USER_ACTION,"select_single_notification"),(0,i.default)(e,"notification_type",_.default.NOTIFICATION_TYPE_MAP[this.props.type]),e));else _.default.sendEvent(_.default.TITLES.SELECT_RECIPIENT_FROM_LIST,_.default.COMPONENTS.MESSAGE_PANE,(0,i.default)({},_.default.PARAMS.USER_ACTION,"select_single_recipient"));this.props.onClick(this.props.id)}}}]),a}(p.Component);E.defaultProps={body:"",onClick:function(){}};var I=E;t.default=I},2657:function(e,t,a){var n=a(0),s=a(2658),i=a(2659),o=a(2),l=a(24);function r(){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.update=this.update.bind(this),this.getContainerRef=function(e){this.container=e}.bind(this)}r.prototype=Object.create(n.Component.prototype),r.prototype.componentDidMount=function(){window.addEventListener("resize",this.update,!1),window.addEventListener("load",this.update,!1),this.dotdotdot(l.findDOMNode(this.container))},r.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.update,!1),window.removeEventListener("load",this.update,!1)},r.prototype.componentDidUpdate=function(){this.dotdotdot(l.findDOMNode(this.container))},r.prototype.dotdotdot=function(e){if(e&&this.props.clamp){if(e.length)throw new Error("Please provide exacly one child to dotdotdot");s(e,i(this.props,["animate","clamp","splitOnChars","truncationChar","truncationHTML","useNativeClamp"]))}},r.prototype.update=function(){this.forceUpdate()},r.prototype.render=function(){return n.createElement(this.props.tagName,{ref:this.getContainerRef,className:this.props.className},this.props.children)},r.propTypes={children:o.node,clamp:o.oneOfType([o.string,o.number,o.bool]).isRequired,truncationChar:o.string,useNativeClamp:o.bool,className:o.string,tagName:o.string},r.defaultProps={truncationChar:"…",useNativeClamp:!1,tagName:"div"},e.exports=r},2658:function(e,t,a){var n,s,i;s=[],void 0===(i="function"==typeof(n=function(){function e(e,t){t=t||{};var a,n=window,s={clamp:t.clamp||2,useNativeClamp:void 0===t.useNativeClamp||t.useNativeClamp,splitOnChars:t.splitOnChars||[".","-","–","—"," "],animate:t.animate||!1,truncationChar:t.truncationChar||"…",truncationHTML:t.truncationHTML},i=e.style,o=e.innerHTML,l=void 0!==e.style.webkitLineClamp,r=s.clamp,c=r.indexOf&&(r.indexOf("px")>-1||r.indexOf("em")>-1);function d(e,t){return n.getComputedStyle||(n.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var a=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),a.test(t)&&(t=t.replace(a,(function(){return arguments[2].toUpperCase()}))),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),n.getComputedStyle(e,null).getPropertyValue(t)}function u(t){var a=t||e.parentNode.clientHeight-e.offsetTop,n=f(e);return Math.max(Math.floor(a/n),0)}function p(t){return f(e)*t}function f(e){var t=d(e,"line-height");return"normal"==t&&(t=1.2*parseFloat(d(e,"font-size"))),Math.round(parseFloat(t))}s.truncationHTML&&((a=document.createElement("span")).innerHTML=s.truncationHTML);var h,m,_,v=s.splitOnChars.slice(0),g=v[0];function E(e){if(e.lastChild){if(e.lastChild.children&&e.lastChild.children.length>0)return E(Array.prototype.slice.call(e.children).pop());if(e.lastChild&&e.lastChild.nodeValue&&e.lastChild.nodeValue!=s.truncationChar&&e.lastChild.nodeType!==Node.COMMENT_NODE)return e.lastChild;var t=e.lastChild;do{if(!t)return;if(3===t.nodeType&&-1===["",s.truncationChar].indexOf(t.nodeValue)&&e.lastChild.nodeType!==Node.COMMENT_NODE)return t;if(t.lastChild){var a=E(t);if(a)return a}t.parentNode.removeChild(t)}while(t=t.previousSibling)}}function I(t,n){if(t&&n){var i=t.nodeValue.replace(s.truncationChar,"");if(h||(g=v.length>0?v.shift():"",h=i.split(g)),h.length>1?(m=h.pop(),C(t,h.join(g))):h=null,a&&(t.nodeValue=t.nodeValue.replace(s.truncationChar,""),e.innerHTML=t.nodeValue+" "+a.innerHTML+s.truncationChar),h){if(e.clientHeight<=n){if(!(v.length>=0&&""!==g))return e.innerHTML;C(t,h.join(g)+g+m),h=null}}else""===g&&(C(t,""),t=E(e),o());if(!s.animate)return I(t,n);setTimeout((function(){I(t,n)}),!0===s.animate?10:s.animate)}function o(){v=s.splitOnChars.slice(0),g=v[0],h=null,m=null}}function C(e,t){e.nodeValue=t+s.truncationChar}if("auto"==r?r=u():c&&(r=u(parseInt(r,10))),l&&s.useNativeClamp)i.overflow="hidden",i.textOverflow="ellipsis",i.webkitBoxOrient="vertical",i.display="-webkit-box",i.webkitLineClamp=r,c&&(i.height=s.clamp+"px");else{var b=p(r);b<e.clientHeight&&(_=I(E(e),b))}return{original:o,clamped:_}}return e})?n.apply(t,s):n)||(e.exports=i)},2659:function(e,t,a){"use strict";var n=a(2660);e.exports=function(e,t){if(!n(e)&&"function"!=typeof e)return{};var a={};if("string"==typeof t)return t in e&&(a[t]=e[t]),a;for(var s=t.length,i=-1;++i<s;){var o=t[i];o in e&&(a[o]=e[o])}return a}},2660:function(e,t,a){"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}}}]);